/* eslint-disable max-len */

const selectors = [
    {
        url: '/allnet-flat-tarife-im-vergleich/',
        selector: '.ce-spacer.ce-space-2',
        position: 'beforebegin',
        margin: false,
        width: 'kam-width-66',
    },
    {
        url: '/smartphone-tarife-im-vergleich',
        selector: '.ge-style-container .ce-spacer.ce-space-1',
        position: 'beforebegin',
        margin: false,
        width: 'kam-width-66',
    },
    {
        url: '/smartphone-tarife-im-vergleich',
        selector: '.ge-style-container .row--bucket ~ .ce-spacer.ce-space-1',
        position: 'beforebegin',
        margin: false,
        width: 'kam-width-66',
    },
    {
        url: '/allnet-flat-',
        selector: 'form[data-testid="planSelectionWrapper"]',
        position: 'afterend',
        margin: false,
        width: 'kam-width-100',
    },
    {
        url: '/fair-flat',
        selector: '.ce-spacer.ce-space-5',
        position: 'beforebegin',
        margin: true,
        width: 'kam-width-50',
    },
    {
        url: '/datentarife/daten-',
        selector: '[data-test-section="eft-shop-plan-configuration--PlanConfiguratorModule"] ~ div.row--relative',
        position: 'afterend',
        margin: true,
        width: 'kam-width-50',
    },
    {
        url: '/datentarife-vergleich',
        selector: '.ce-spacer.ce-space-5',
        position: 'beforebegin',
        margin: false,
        width: 'kam-width-66',
    },
];

export const images = {
    generic: 'https://storage.kameleoon.com/congstar/mdm-deep-sell/Testimonials_MGM_generisch.png',
    genericMobile: 'https://storage.kameleoon.com/congstar/mdm-deep-sell/Testimonials_MGM_generisch_mobile.png',
    only10: 'https://storage.kameleoon.com/congstar/mdm-deep-sell/Testimonials_MGM_nur10.png',
    only10Mobile: 'https://storage.kameleoon.com/congstar/mdm-deep-sell/Testimonials_MGM_nur10_mobile.png',
    taschenCheckout: 'https://storage.kameleoon.com/congstar/t26/taschen_TY.png',
    bgDesktop: 'https://storage.kameleoon.com/congstar/mdm-deep-sell/background_desktop.png',
    bgDesktopLong: 'https://storage.kameleoon.com/congstar/t26/background_desktop_long.png',
    bgMobile: 'https://storage.kameleoon.com/congstar/mdm-deep-sell/backgrond_mobile.png',
    bgCheckout: 'https://storage.kameleoon.com/congstar/mdm-deep-sell/background_checkout.png',
};

export const newBubble = `
<svg xmlns="http://www.w3.org/2000/svg" width="89.709" height="88.806" viewBox="0 0 89.709 88.806">
  <g id="Gruppe_19" data-name="Gruppe 19" transform="matrix(0.996, -0.087, 0.087, 0.996, 0, 7.224)">
    <g id="stoerer-rund-online" transform="translate(0 0)">
      <g id="stoerer-rund-online-2" data-name="stoerer-rund-online" transform="translate(0 0)">
        <g id="störer_-_rund_1_">
          <path id="Pfad_1303" data-name="Pfad 1303" 
            d="M33.583,3.965c2.773-.4,5.712-4.147,8.295-3.958,2.56.19,4.527,
            3.152,6.707,3.555s5.712-1.967,8.082-1c2.37,1,3.152,5.332,4.93,
            6.707s6.3.19,8.485,2.56,1.588,5.925,2.56,7.489,4.93,3.555,6.3,
            5.522-1,5.925-.593,8.082,4.148,5.119,4.527,7.892c.19,1.778-3.365,
            5.333-3.958,7.11s1.967,6.115.592,8.485-5.925,3.555-6.707,5.332-.782,
            6.517-2.18,8.082S62.544,72.6,62.544,72.6s-2.962,5.522-5.332,
            6.3-6.115-1.588-8.082-1-5.712,
            4.337-8.082,3.958c-2.37-.4-4.93-3.555-7.3-3.958-2.773.782-5.332,
            1.777-7.7.782s-2.56-4.93-4.74-6.3-7.489-.19-9.267-2.56-.782-5.332-1.967-7.489c-1.185-2.18-5.332-2.18-6.517-4.93,
            0-1.375.782-5.925.592-7.892C4.55,46.364,0,43.8,0,41.221c0-2.56,3.958-4.74,
            4.337-6.9S2.37,27.617,3.152,25.65s6.3-3.365,7.11-5.332.19-7.11,1.967-8.674,
            6.115-.592,8.082-1.967,1.375-4.74,4.527-6.3S30.81,4.368,33.583,3.965Z" fill="#fff"/>
        </g>
      </g>
    </g>
    <text id="Jetzt_neu_" data-name="Jetzt neu!" 
    transform="translate(41.443 37.947)" font-size="16" 
    font-family="Interstate-Bold, Interstate" font-weight="700">
    <tspan x="-21" y="0">Jetzt</tspan><tspan x="-16" y="18">neu!</tspan></text>
  </g>
</svg>
`;

export const simCard = `
<svg xmlns="http://www.w3.org/2000/svg" width="179" height="128.6" viewBox="0 0 333.515 239.404">
  <g id="Gruppe_3" data-name="Gruppe 3" transform="translate(-8.243 -4.292)">
    <g id="SIM-Karte_weiß" data-name="SIM-Karte weiß" transform="matrix(-0.391, 0.921, -0.921, -0.391, 106.661, 123.994)">
      <g id="SIM-Karte_weiß-2" data-name="SIM-Karte weiß" transform="translate(-103.261 -63.087)">
        <g id="img_prepaid_card" transform="translate(0 0)">
          <path id="Rectangle" d="M12.558,0h181.4c7.707,0,12.558,4.795,12.558,12.411V85.884c0,3.307.193,7.883-1.993,10.387l-21.042,25.121a14.024,14.024,0,0,1-10.565,4.782H12.559C4.852,126.173,0,121.379,0,113.763V12.411C0,4.795,4.852,0,12.558,0Z" fill="#fff"/>
          <path id="Combined-Shape" d="M45.854,3.735V13.818c0,3.859-2.268,6.224-5.921,6.224a13.239,13.239,0,0,1-3.653-.622h-.126a.851.851,0,0,1-.756-.5,1.082,1.082,0,0,1-.126-.871.841.841,0,0,1,.5-.747,1.118,1.118,0,0,1,.882-.124h.126a10.847,10.847,0,0,0,2.9.5c1.134,0,3.527-.373,3.527-3.112a6.168,6.168,0,0,1-2.268.373c-3.4,0-5.921-2.241-5.921-5.477a5.627,5.627,0,0,1,5.921-5.726h4.913Zm32.627,0V13.943a1.255,1.255,0,0,1-1.26,1.245c-.63,0-.882-.373-1.134-.871a5.789,5.789,0,0,1-2.519.622c-3.4,0-5.921-2.241-5.921-5.477a5.627,5.627,0,0,1,5.921-5.726h4.913Zm-22.549,0a1.245,1.245,0,1,1,0,2.49H51.649a.912.912,0,0,0-1.008,1.12.988.988,0,0,0,1.008,1h2.519A3.584,3.584,0,0,1,57.7,11.826a3.4,3.4,0,0,1-3.527,3.361H49.885l-.242-.022a1.244,1.244,0,0,1,.242-2.468h4.283a1.024,1.024,0,0,0,1.134-1,1.122,1.122,0,0,0-1.134-1.12H51.649A3.5,3.5,0,0,1,48.122,7.1a3.4,3.4,0,0,1,3.527-3.361h4.283ZM15.243,3.486A5.851,5.851,0,1,1,9.322,9.337,5.879,5.879,0,0,1,15.243,3.486ZM61.1,0a1.255,1.255,0,0,1,1.26,1.245h0V3.61H66.01a1.245,1.245,0,1,1,0,2.49H62.356v5.353c0,.871.378,1.12,1.26,1.12H66.01a1.245,1.245,0,1,1,0,2.49H63.364a3.421,3.421,0,0,1-3.527-3.735h0V1.369A1.363,1.363,0,0,1,61.1,0ZM84.654,3.735c2.9,0,4.535,1.618,4.535,4.357h0L89.17,8.3a1.26,1.26,0,0,1-2.5-.207h0l-.011-.3c-.09-1.159-.725-1.689-2-1.689h-.882v7.594a1.26,1.26,0,0,1-2.519,0h0V3.735ZM28.092,3.61A4.768,4.768,0,0,1,33,8.59h0v4.98a1.26,1.26,0,0,1-2.519,0h0V8.59A2.406,2.406,0,0,0,28.092,6.1H25.7v7.594a1.26,1.26,0,0,1-2.519,0h0V3.61ZM7.18,3.735a1.245,1.245,0,1,1,0,2.49H6.047c-1.764,0-3.4.871-3.4,2.988a3.187,3.187,0,0,0,3.4,3.237H7.18a1.245,1.245,0,1,1,0,2.49H5.669a5.6,5.6,0,1,1,0-11.2H7.18Zm8.062,2.116a3.225,3.225,0,0,0-3.275,3.486,3.282,3.282,0,1,0,6.551,0A3.225,3.225,0,0,0,15.243,5.851ZM75.961,6.1H73.568a3.159,3.159,0,0,0-3.275,3.486c0,1.867,1.26,2.988,3.4,2.988a3.471,3.471,0,0,0,2.268-1h0V6.1Zm-32.627,0H40.941a3.159,3.159,0,0,0-3.275,3.486c0,1.867,1.26,2.988,3.4,2.863a3.544,3.544,0,0,0,2.268-.747h0V6.1Z" transform="translate(161.985 103.831) rotate(-90)" fill-rule="evenodd"/>
          <g id="Group" transform="translate(14.652 15.168)">
            <path id="Rectangle-2" data-name="Rectangle" d="M13.954,0h87.212A13.872,13.872,0,0,1,115.12,13.789V56.537a13.872,13.872,0,0,1-13.954,13.789H13.954A13.872,13.872,0,0,1,0,56.537V13.789A13.872,13.872,0,0,1,13.954,0Z" transform="translate(0 0.689)" fill="#bd9e6a"/>
            <ellipse id="Oval" cx="2.477" cy="2.477" rx="2.477" ry="2.477" transform="translate(55.082 5.452)" fill="#1c1c1c"/>
            <path id="Rectangle-3" data-name="Rectangle" d="M0,0H30l-1.4,2.068H0Z" transform="translate(11.163 0.689)" fill="#1c1c1c"/>
            <path id="Rectangle-4" data-name="Rectangle" d="M0,2.068H30L28.605,0H0Z" transform="translate(11.163 68.947)" fill="#1c1c1c"/>
            <path id="Rectangle-5" data-name="Rectangle" d="M0,2.068H14.652V0H0Z" transform="translate(50.234 68.947)" fill="#1c1c1c"/>
            <path id="Rectangle-6" data-name="Rectangle" d="M0,2.068H14.652V0H0Z" transform="translate(50.234 0.689)" fill="#1c1c1c"/>
            <path id="Rectangle-7" data-name="Rectangle" d="M0,0H30V2.068H1.4Z" transform="translate(73.956 0.689)" fill="#1c1c1c"/>
            <path id="Rectangle-8" data-name="Rectangle" d="M0,2.068H30V0H1.4Z" transform="translate(73.956 68.947)" fill="#1c1c1c"/>
            <rect id="Rectangle-9" data-name="Rectangle" width="39.769" height="2.477" transform="translate(0 25.51)" fill="#1c1c1c"/>
            <rect id="Rectangle-10" data-name="Rectangle" width="39.769" height="2.477" transform="translate(0 46.195)" fill="#1c1c1c"/>
            <rect id="Rectangle-11" data-name="Rectangle" width="39.769" height="2.477" transform="translate(75.351 25.51)" fill="#1c1c1c"/>
            <rect id="Rectangle-12" data-name="Rectangle" width="39.769" height="2.477" transform="translate(75.351 46.195)" fill="#1c1c1c"/>
            <path id="Oval-2" data-name="Oval" d="M18.572,71.705C10.12,71.705,2.879,61.567.335,47c-.31-1.777-.156-3.123.517-6.438a22.161,22.161,0,0,0,.627-4.711,16.234,16.234,0,0,0-.712-4.23C.05,28.8-.136,27.631.092,26.1,2.371,10.811,9.8,0,18.572,0s16.21,10.806,18.484,26.1c.227,1.528.041,2.695-.677,5.521a16.249,16.249,0,0,0-.714,4.232,22.21,22.21,0,0,0,.637,4.724c.676,3.318.835,4.673.534,6.423C34.326,61.6,27.076,71.705,18.572,71.705Zm0-1.379c7.634,0,14.478-9.541,16.889-23.558.262-1.522.115-2.776-.526-5.92a23.26,23.26,0,0,1-.665-5,17.288,17.288,0,0,1,.755-4.567c.671-2.643.84-3.7.65-4.985C33.49,11.6,26.463,1.379,18.572,1.379S3.663,11.605,1.473,26.3c-.192,1.286-.023,2.344.647,4.986a17.275,17.275,0,0,1,.754,4.566,23.23,23.23,0,0,1-.655,4.982c-.638,3.142-.78,4.384-.51,5.932C4.152,60.751,10.991,70.326,18.572,70.326Z" transform="translate(38.988 0)" fill="#1c1c1c"/>
          </g>
          <path id="Rectangle-13" data-name="Rectangle" d="M10.465,1.379A9.017,9.017,0,0,0,1.4,10.342V93.768a9.017,9.017,0,0,0,9.07,8.963H98.127a16.144,16.144,0,0,0,11.347-4.645l12.109-11.966a15.764,15.764,0,0,0,4.7-11.213V10.342a9.017,9.017,0,0,0-9.07-8.963Zm0-1.379H117.213a10.4,10.4,0,0,1,10.465,10.342V74.908A17.135,17.135,0,0,1,122.569,87.1L110.461,99.062a17.548,17.548,0,0,1-12.334,5.049H10.465A10.4,10.4,0,0,1,0,93.768V10.342A10.4,10.4,0,0,1,10.465,0Z" transform="translate(8.372 8.274)"/>
        </g>
      </g>
    </g>
    <g id="Gruppe_2" data-name="Gruppe 2">
      <g id="stoerer-rund-online" transform="translate(174.981 9.002)">
        <g id="stoerer-rund-online-2" data-name="stoerer-rund-online">
          <g id="störer_-_rund_1_">
            <path id="Pfad_1" data-name="Pfad 1" d="M71.073,14.648c5.579-.811,11.493-8.345,16.69-7.964,5.15.381,9.108,6.342,13.5,7.153s11.493-3.958,16.261-2c4.769,2,6.342,10.73,9.919,13.5s12.685.382,17.072,5.15,3.2,11.922,5.15,15.069,9.919,7.153,12.685,11.111-2,11.922-1.192,16.261,8.345,10.3,9.108,15.88c.382,3.577-6.772,10.73-7.964,14.306s3.958,12.3,1.192,17.072-11.922,7.153-13.5,10.73-1.574,13.114-4.387,16.261-16.261,5.579-16.261,5.579-5.961,11.111-10.73,12.685-12.3-3.2-16.261-2-11.493,8.727-16.261,7.964c-4.769-.811-9.919-7.153-14.688-7.964-5.579,1.574-10.73,3.577-15.5,1.574s-5.15-9.919-9.537-12.685-15.069-.381-18.646-5.15-1.574-10.73-3.958-15.069c-2.384-4.387-10.73-4.387-13.114-9.919,0-2.766,1.574-11.922,1.192-15.88C12.656,99.96,3.5,94.81,3.5,89.612c0-5.15,7.964-9.537,8.727-13.877S8.269,62.24,9.842,58.282s12.685-6.772,14.306-10.73S24.53,33.246,28.107,30.1s12.3-1.192,16.261-3.958,2.766-9.537,9.108-12.685S65.493,15.459,71.073,14.648Z" transform="translate(-3.5 -6.671)" fill="#fccb37"/>
          </g>
        </g>
      </g>
      <g id="Gruppe_1" data-name="Gruppe 1" transform="translate(206.615 49.702)">
        <text id="_50_" data-name="50 %" transform="translate(51.297 75.298)" font-size="39" font-family="Interstate-Bold, Interstate" font-weight="700" letter-spacing="-0.003em"><tspan x="-51" y="0">50 %</tspan></text>
        <text id="Bis_zu" data-name="Bis zu" transform="translate(50.297 31.298)" font-size="29" font-family="Interstate-Bold, Interstate" font-weight="700" letter-spacing="-0.003em"><tspan x="-42" y="0">Bis zu</tspan></text>
      </g>
    </g>
  </g>
</svg>
`;

const newLabel = `
<svg xmlns="http://www.w3.org/2000/svg" id="Smartphone_-_Promotion_label" data-name="Smartphone - Promotion label" width="77" height="20" viewBox="0 0 77 20">
  <path id="Background" d="M0,0H77V20H0Z" fill="#fff"/>
  <text id="Jetzt_neu_" data-name="Jetzt neu!" transform="translate(8 14)" 
  font-size="12" font-family="Interstate-Bold, Interstate" font-weight="700" 
  letter-spacing="0.01em"><tspan x="0" y="0">Jetzt neu!</tspan></text>
</svg>
`;

const buildBox = (bannerData, width) => `
    <div class="kam-T05-container ${width}">
        <a class="kam-link" href="${bannerData.link}">
            <div class="kam-content">
                <div class="kam-headline">${bannerData.headline}</div>
                <div class="kam-text">${bannerData.text}</div>
                <div class="kam-button">${bannerData.button}</div>
            </div>
            <div class="kam-desktop">
                ${newBubble}
                <img class="kam-desktop-img" src="${bannerData.images[0]}">
            </div>
            <img class="kam-mobile" src="${bannerData.images[1]}">
        </a>
        <div class="kam-mobile kam-new">
            ${newLabel}
        </div>
    </div>
`;

const buildBoxSvg = (bannerData, width) => `
    <div class="kam-T05-container ${width}">
        <a class="kam-link" href="${bannerData.link}">
            <div class="kam-content">
                <div class="kam-headline">${bannerData.headline}</div>
                <div class="kam-text">${bannerData.text}</div>
                <div class="kam-button">${bannerData.button}</div>
            </div>
            ${bannerData.images[0]}
        </a>
    </div>
`;

const buildBoxTY = (bannerData, svg) => `
<div class="kam-T05-container-TY">
  <div class="kam-left">
    <a class="kam-link" href="${bannerData.linkLeft}">  
      <div class="kam-content">
        <div class="kam-headline">${bannerData.headlineLeft}</div>
        <div class="kam-text">${bannerData.textLeft}</div>
        <div class="kam-button">${bannerData.buttonLeft}</div>
      </div>
      <div class="kam-desktop" style="position: relative;width: 100%;">
        ${newBubble}
        <img class="kam-desktop-image" src="${bannerData.images[0]}">
      </div>
      <img class="kam-mobile" src="${bannerData.images[1]}">
    </a>
    <div class="kam-mobile kam-new">
        ${newLabel}
    </div>
  </div>
  <div class="kam-right">
    <a class="kam-link" href="${bannerData.linkRight}">
      <div class="kam-content">
        <div class="kam-headline">${bannerData.headlineRight}</div>
        <div class="kam-text">${bannerData.textRight}</div>
        <div class="kam-button">${bannerData.buttonRight}</div>
      </div>
      ${svg ? bannerData.images[2] : `
        <img src="${bannerData.images[2]}"></img>
      `}
    </a>
  </div>
</div>
`;

export function createElement(bannerData, svg, goals, v3) {
    selectors.forEach((data) => {
        if (document.location.pathname.includes(data.url)) {
            Kameleoon.API.Core.runWhenElementPresent(data.selector, ([element]) => {
                element.insertAdjacentHTML(data.position, svg ? buildBoxSvg(bannerData, data.width) : buildBox(bannerData, data.width));
                if (data.margin) {
                    const banner = document.querySelector('.kam-T05-container');
                    banner.classList.add('kam-margin-left');
                }
            });
        }
    });

    Kameleoon.API.Core.runWhenElementPresent('.kam-T05-container', ([banner]) => {
        Kameleoon.API.Utils.addEventListener(banner, 'click', () => {
            const { pathname } = document.location;

            Kameleoon.API.Goals.processConversion(goals['[T26] Banner click']);

            if (pathname.match(/\/(allnet-flat|smartphone)-tarife-im-vergleich/gm)) {
                if (!v3) {
                    Kameleoon.API.Goals.processConversion(goals['[T26] Click Friends Vergleich']);
                } else {
                    Kameleoon.API.Goals.processConversion(goals['[T26] Click Partnerkarte Vergleich']);
                }
            } else if (pathname.match(/\/((allnet-flat-(s|m|l))|(fair-flat))/gm)) {
                if (!v3) {
                    Kameleoon.API.Goals.processConversion(goals['[T26] Click Friends Tarifseite']);
                } else {
                    Kameleoon.API.Goals.processConversion(goals['[T26] Click Partnerkarte Tarifseite']);
                }
            } else if (pathname.match(/\/daten-(s|m|l)/gm)) {
                if (!v3) {
                    Kameleoon.API.Goals.processConversion(goals['[T26] Click Friends Datentarif']);
                } else {
                    Kameleoon.API.Goals.processConversion(goals['[T26] Click Partnerkarte Datentarif']);
                }
            } else if (pathname.match(/\/datentarife-vergleich/gm)) {
                if (!v3) {
                    Kameleoon.API.Goals.processConversion(goals['[T26] Click Friends Vergleich Daten']);
                } else {
                    Kameleoon.API.Goals.processConversion(goals['[T26] Click Partnerkarte Vergleich Daten']);
                }
            }
        });

        function setObserver() {
            const options = {
                rootMargin: '0px',
                threshold: 0.50,
            };
            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        Kameleoon.API.Goals.processConversion(goals['[T26] Banner view']);
                        observer.disconnect();
                    }
                });
            }, options);
            observer.observe(banner);
        }

        setObserver();
    });
}

export function createElementTY(parent, bannerData, svg, goals, v3) {
    parent.insertAdjacentHTML('beforebegin', buildBoxTY(bannerData, svg));

    Kameleoon.API.Utils.addEventListener(document, 'click', ({ target }) => {
        if (!v3 && target.closest('a[href="https://www.congstar.de/congstar-deals/"]')) {
            Kameleoon.API.Goals.processConversion(goals['[T26] Click Congstar Deals TY']);
        } else if (target.closest('a[href="https://www.congstar.de/for-friends"]')) {
            Kameleoon.API.Goals.processConversion(goals['[T26] Click Friends TY']);
        } else if (v3 && target.closest('a[href="https://www.congstar.de/meincongstar/angebote/partnerkarte/"]')) {
            Kameleoon.API.Goals.processConversion(goals['[T26] Click Partnerkarte TY']);
        }
    });
}
